// 嵌入式語言資料
const LANGUAGE_DATA = {
  "en": {"alt":{"interviewScene":"Interview scenario","appStore":"Download on App Store","googlePlay":"Get it on Google Play"},"meta":{"title":"Dopi Note — Meeting Recording, Transcription in 1 Minute","description":"Dopi Note: AI smart recording notes, complete transcription and key point summary in 1 minute. No login required, high privacy, supports 20+ languages."},"og":{"title":"Dopi Note — Meeting Recording, Transcription in 1 Minute","description":"AI smart summary makes every word valuable. No login required, high privacy, supports 20+ languages."},"nav":{"brand":"Dopi Note","download":"Download Now"},"useCases":{"title":"Do you also face these challenges?","meeting":{"title":"During Meetings","description":"Want to focus but have to take notes"},"interview":{"title":"During Interviews","description":"Hope to listen attentively but need to record every word"},"lecture":{"title":"During Lectures","description":"Non-native language is hard to understand, fast pace is hard to follow"}},"features":{"title":"Dopi Note Is Here to Help","assistant":{"title":"Most Powerful Meeting Assistant","items":["Automatically recognizes multiple languages, quickly generates transcripts","Automatically identifies scenarios, generates traceable summaries","Automatically translates meeting records to your language"]},"security":{"title":"Most Secure Data Management","items":["Login for cloud sync, no worry about data loss","Choose local mode, data stays only on your phone"]},"pricing":{"title":"Most Flexible Payment Model","items":["No subscription, purchase hours to enjoy full features","Pay as you use, super flexible","Hours never expire"]}},"slogan":{"title":"You just focus, let AI note"},"faq":{"title":"Frequently Asked Questions","q1":{"q":"What is Dopi Note?","a":"Dopi Note is an AI meeting assistant app that generates transcripts and summaries in just 1 minute. It features exclusive terminology correction and highly flexible summary formats, available on both iOS and Android."},"q2":{"q":"Are my recordings and notes secure?","a":"Absolutely. Your privacy is our top priority:\n• Audio stays on device → Original recordings are always stored only on your phone\n• Data can stay offline → Switch to local mode and all data stays on your phone\n• Cloud is encrypted → After login, text data is encrypted and backed up for cross-device access"},"q3":{"q":"Is it free? How does billing work?","a":"• Free to start → New users get 3 hours free upon registration\n• No subscription pressure → No monthly or annual fees; pay-per-hour plans, buy as needed, credits never expire"},"q4":{"q":"Why should I log in?","a":"Logging in makes things more convenient:\n• Cross-device sync → Seamlessly access all your notes on phone and tablet\n• Auto backup → Safely back up your work, no worries when switching phones"},"q5":{"q":"What languages are supported? Does it translate?","a":"• Auto language detection → You don't need to do anything, the app automatically detects multiple languages\n• Auto summary translation → Summaries are automatically translated to your preferred language, so you instantly understand foreign-language meetings!"},"q6":{"q":"Is there a recording time limit?","a":"No limit! However, we recommend splitting long meetings into segments for the best results and easier management."},"q7":{"q":"Can I customize the summary format?","a":"AI automatically selects the best format for your content. You can also choose from concise, detailed, bullet points, action items, or custom formats."},"q8":{"q":"How do I import external audio files?","a":"Super easy, two ways:\n• Share from any app → Tap \"Share\" in LINE, cloud drives, etc.\n• Import from within the app → Tap the \"+\" button and select files from your phone (supports mp3, m4a, wav, and more)"},"q9":{"q":"How do I export meeting notes?","a":"One-tap share! Save as Word, PDF, TXT plain text, or directly copy the content to send to others."},"q10":{"q":"How is Dopi Note different from other recording apps?","a":"Dopi Note stands out with its highly flexible summary formats, local-mode privacy protection, and flexible pay-per-hour billing — no subscription required."},"q11":{"q":"How accurate is the transcription?","a":"AI recognition accuracy depends on recording quality. In quiet environments with clear audio, accuracy is very high. We recommend keeping your phone close to the speaker and avoiding excessive background noise for the best results."},"q12":{"q":"Will my data be used to train AI?","a":"No. Your recordings and notes are for your personal use only. We do not use any user data for AI model training. Your privacy is our highest principle."}},"download":{"title":"Download Dopi Note - Time Back to You"},"contact":{"label":"Contact Us:","email":"yijhen.yang@gmail.com"},"footer":{"copyright":"© 2025 Dopi Note. All rights reserved."}},
  "zh-TW": {"alt":{"interviewScene":"訪談情境","appStore":"在 App Store 下載","googlePlay":"在 Google Play 下載"},"meta":{"title":"Dopi Note — 會議錄音，1分鐘變逐字稿","description":"Dopi Note：AI 智慧錄音筆記，1分鐘完成逐字稿與重點整理。免登入、高隱私、支援20+語言。"},"og":{"title":"Dopi Note — 會議錄音，1分鐘變逐字稿","description":"AI 智慧摘要，讓每句話都有價值。免登入、高隱私、支援20+語言。"},"nav":{"brand":"Dopi Note","download":"立即下載"},"useCases":{"title":"你是否也有這些困擾？","meeting":{"title":"開會時","description":"想專心討論，卻得分心做筆記"},"interview":{"title":"訪談時","description":"希望專注聆聽，但需完整記錄每句話"},"lecture":{"title":"聽演講時","description":"非母語好難懂，語速快跟不上"}},"features":{"title":"Dopi Note 來幫你","assistant":{"title":"最強大的會議助理","items":["自動辨識多國語言，快速生成逐字稿","自動辨識場景，生成可溯源的摘要","自動將會議記錄翻譯成你的語言"]},"security":{"title":"最安全的資料管理","items":["登入可享雲端同步，不用擔心資料遺失","選擇本機模式，資料只存在手機"]},"pricing":{"title":"最彈性的付費機制","items":["免訂閱，購買時數即可享有全功能","用多少買多少，超彈性","時數永不過期"]}},"slogan":{"title":"你只需專注，讓AI紀錄"},"faq":{"title":"常見問題","q1":{"q":"Dopi Note 是什麼？","a":"Dopi Note 是一款 AI 會議助理 App，1 分鐘即可生成逐字稿與摘要。獨家支援名詞修正與超靈活的摘要格式，iOS 與 Android 平台皆可使用。"},"q2":{"q":"我的錄音和筆記安全嗎？","a":"絕對安全。您的隱私是我們的第一要務：\n• 音檔不離機 → 原始錄音檔永遠只儲存在您的手機裡\n• 資料可離線 → 切換為本機模式，所有資料就只存在手機\n• 雲端有加密 → 登入後，文字資料加密備份，方便跨裝置使用"},"q3":{"q":"要收費嗎？怎麼算錢？","a":"• 免費開始 → 新用戶註冊即贈 3 小時免費時數\n• 無訂閱壓力 → 沒有月費或年費，採時數方案，用多少買多少，額度永不過期"},"q4":{"q":"我為什麼要登入？","a":"登入是為了讓您更方便：\n• 跨裝置同步 → 在手機、平板上無縫接軌，存取所有筆記\n• 自動備份 → 安全備份您的心血，換手機也不怕遺失"},"q5":{"q":"支援哪些語言？會幫我翻譯嗎？","a":"• AI 自動識別 → 您不用做任何事，App 會自動識別多國語言\n• 摘要自動翻譯 → 摘要會自動翻成您慣用的語言，讓您秒懂外語會議！"},"q6":{"q":"錄音可以錄多長？","a":"沒有限制！不過建議長會議可以分段錄，效果最好也方便管理。"},"q7":{"q":"摘要可以自訂格式嗎？","a":"AI 會自動選擇最適合的格式。您也可以選擇精簡、詳細、條列、行動項目或自訂格式。"},"q8":{"q":"怎麼匯入外部音檔？","a":"超簡單，兩種方式：\n• 從任何 App 分享 → 在 LINE、雲端硬碟中點「分享」即可\n• 從 App 內匯入 → 點擊「+」號，直接選取手機檔案（支援 mp3, m4a, wav 等格式）"},"q9":{"q":"怎麼匯出會議記錄？","a":"一鍵分享！可以存成 Word, PDF, TXT 純文字檔，或直接複製內容傳給別人。"},"q10":{"q":"跟其他錄音 App 有什麼不同？","a":"Dopi Note 以超靈活摘要格式、本機模式隱私保護、彈性時數計費三大特色脫穎而出，無需訂閱。"},"q11":{"q":"逐字稿的準確度高嗎？","a":"AI 辨識準確度會受錄音品質影響。在安靜環境、清晰收音的情況下，準確度非常高。建議錄音時將手機靠近說話者，避免過多背景噪音，即可獲得最佳效果。"},"q12":{"q":"我的資料會被用來訓練 AI 嗎？","a":"不會。您的錄音與筆記僅供您個人使用，我們不會將任何使用者資料用於 AI 模型訓練。您的隱私是我們的最高原則。"}},"download":{"title":"下載Dopi Note - 把時間還給你"},"contact":{"label":"聯絡我們：","email":"yijhen.yang@gmail.com"},"footer":{"copyright":"© 2025 Dopi Note. All rights reserved."}},
  "ja": {"alt":{"interviewScene":"インタビューシーン","appStore":"App Store からダウンロード","googlePlay":"Google Play で入手"},"meta":{"title":"Dopi Note — 会議録音、1分で文字起こし","description":"Dopi Note：AI スマート録音ノート、1分で文字起こしと要点整理を完了。ログイン不要、高プライバシー、20以上の言語をサポート。"},"og":{"title":"Dopi Note — 会議録音、1分で文字起こし","description":"AI スマート要約で、すべての言葉に価値を。ログイン不要、高プライバシー、20以上の言語をサポート。"},"nav":{"brand":"Dopi Note","download":"今すぐダウンロード"},"useCases":{"title":"こんな悩みはありませんか？","meeting":{"title":"会議中","description":"集中したいのに、メモを取るのに気を取られる"},"interview":{"title":"インタビュー中","description":"話に集中したいが、すべての言葉を記録する必要がある"},"lecture":{"title":"講演を聞く時","description":"母国語でないので理解が困難、話すスピードについていけない"}},"features":{"title":"Dopi Note がお手伝い","assistant":{"title":"最強の会議アシスタント","items":["多言語を自動認識、素早く文字起こしを生成","シナリオを自動識別、トレース可能な要約を生成","会議記録を自動であなたの言語に翻訳"]},"security":{"title":"最も安全なデータ管理","items":["ログインでクラウド同期、データ紛失の心配なし","ローカルモードを選択、データはスマートフォンのみに保存"]},"pricing":{"title":"最も柔軟な料金体系","items":["サブスクリプション不要、時間を購入して全機能を享受","使った分だけ購入、超柔軟","時間は永続有効"]}},"slogan":{"title":"あなたは集中するだけ、AIがノート"},"faq":{"title":"よくある質問","q1":{"q":"Dopi Note とは何ですか？","a":"Dopi Note は AI 会議アシスタントアプリで、わずか1分で文字起こしと要約を生成します。独自の用語修正と柔軟な要約フォーマットに対応。iOS・Android 両方でご利用いただけます。"},"q2":{"q":"録音やノートは安全ですか？","a":"ご安心ください。プライバシーは最優先事項です：\n• 音声はデバイスに保存 → 元の録音ファイルは常にお使いのスマートフォンにのみ保存されます\n• データはオフライン可 → ローカルモードに切り替えれば、すべてのデータはスマートフォン内のみに保存\n• クラウドは暗号化 → ログイン後、テキストデータは暗号化バックアップされ、デバイス間で便利にアクセス"},"q3":{"q":"料金はかかりますか？課金方式は？","a":"• 無料で開始 → 新規ユーザーは登録時に3時間分の無料クレジット付き\n• サブスク不要 → 月額・年額なし、時間制プランで必要な分だけ購入、クレジットは無期限"},"q4":{"q":"なぜログインが必要ですか？","a":"ログインでより便利になります：\n• デバイス間同期 → スマートフォンやタブレットですべてのノートにシームレスにアクセス\n• 自動バックアップ → 大切なデータを安全にバックアップ、機種変更時も安心"},"q5":{"q":"対応言語は？翻訳もしてくれますか？","a":"• AI が自動認識 → 何もする必要はありません、アプリが多言語を自動で認識します\n• 要約を自動翻訳 → 要約はお好みの言語に自動翻訳され、外国語の会議も即座に理解できます！"},"q6":{"q":"録音時間に制限はありますか？","a":"制限はありません！ただし、長い会議は分割して録音すると、より良い結果が得られ管理も簡単です。"},"q7":{"q":"要約のフォーマットはカスタマイズできますか？","a":"AI がコンテンツに最適なフォーマットを自動選択します。簡潔、詳細、箇条書き、アクションアイテム、カスタムフォーマットから選ぶこともできます。"},"q8":{"q":"外部の音声ファイルはどうやってインポートしますか？","a":"とても簡単、2つの方法があります：\n• どのアプリからでも共有 → LINE やクラウドドライブで「共有」をタップするだけ\n• アプリ内からインポート → 「+」ボタンをタップして、スマートフォンのファイルを直接選択（mp3、m4a、wavなどに対応）"},"q9":{"q":"会議記録はどうやってエクスポートしますか？","a":"ワンタップで共有！Word、PDF、TXTテキストファイルとして保存、または内容をそのままコピーして他の人に送れます。"},"q10":{"q":"他の録音アプリとの違いは？","a":"Dopi Note は柔軟な要約フォーマット、ローカルモードのプライバシー保護、柔軟な従量課金の3つの特徴で差別化されています。サブスクリプション不要です。"},"q11":{"q":"文字起こしの精度は高いですか？","a":"AI認識の精度は録音品質に左右されます。静かな環境でクリアな音声であれば、非常に高い精度が得られます。録音時はスマートフォンを話者の近くに置き、過度な背景ノイズを避けることで最良の結果が得られます。"},"q12":{"q":"私のデータはAIの学習に使用されますか？","a":"いいえ。お客様の録音とノートはお客様専用です。ユーザーデータをAIモデルのトレーニングに使用することは一切ありません。お客様のプライバシーは私たちの最優先事項です。"}},"download":{"title":"Dopi Noteをダウンロード - 時間をあなたに"},"contact":{"label":"お問い合わせ：","email":"yijhen.yang@gmail.com"},"footer":{"copyright":"© 2025 Dopi Note. All rights reserved."}},
  "es": {"alt":{"interviewScene":"Escena de entrevista","appStore":"Descargar en App Store","googlePlay":"Disponible en Google Play"},"meta":{"title":"Dopi Note — Grabación de reuniones, transcripción en 1 minuto","description":"Dopi Note: Notas de grabación inteligente AI, transcripción completa y resumen de puntos clave en 1 minuto. Sin inicio de sesión requerido, alta privacidad, soporta más de 20 idiomas."},"og":{"title":"Dopi Note — Grabación de reuniones, transcripción en 1 minuto","description":"Resumen inteligente AI hace que cada palabra sea valiosa. Sin inicio de sesión requerido, alta privacidad, soporta más de 20 idiomas."},"nav":{"brand":"Dopi Note","download":"Descargar Ahora"},"useCases":{"title":"¿También enfrentas estos desafíos?","meeting":{"title":"Durante Reuniones","description":"Quiero concentrarme pero tengo que tomar notas"},"interview":{"title":"Durante Entrevistas","description":"Espero escuchar atentamente pero necesito grabar cada palabra"},"lecture":{"title":"Durante Conferencias","description":"El idioma no nativo es difícil de entender, el ritmo rápido es difícil de seguir"}},"features":{"title":"Dopi Note Está Aquí Para Ayudar","assistant":{"title":"Asistente de Reuniones Más Poderoso","items":["Reconoce automáticamente múltiples idiomas, genera transcripciones rápidamente","Identifica automáticamente escenarios, genera resúmenes trazables","Traduce automáticamente los registros de reuniones a tu idioma"]},"security":{"title":"Gestión de Datos Más Segura","items":["Inicia sesión para sincronización en la nube, sin preocupación por pérdida de datos","Elige el modo local, los datos se quedan solo en tu teléfono"]},"pricing":{"title":"Modelo de Pago Más Flexible","items":["Sin suscripción, compra horas para disfrutar de todas las características","Paga según uses, súper flexible","Las horas nunca expiran"]}},"slogan":{"title":"Solo concéntrate, deja que la IA tome notas"},"faq":{"title":"Preguntas Frecuentes","q1":{"q":"¿Qué es Dopi Note?","a":"Dopi Note es una app de asistente de reuniones con IA que genera transcripciones y resúmenes en solo 1 minuto. Cuenta con corrección exclusiva de terminología y formatos de resumen altamente flexibles, disponible en iOS y Android."},"q2":{"q":"¿Mis grabaciones y notas están seguras?","a":"Absolutamente. Tu privacidad es nuestra máxima prioridad:\n• El audio no sale del dispositivo → Las grabaciones originales siempre se almacenan solo en tu teléfono\n• Datos offline disponibles → Cambia al modo local y todos los datos se quedan en tu teléfono\n• La nube está cifrada → Después de iniciar sesión, los datos de texto se respaldan cifrados para acceso entre dispositivos"},"q3":{"q":"¿Es gratis? ¿Cómo funciona el cobro?","a":"• Comienza gratis → Los nuevos usuarios reciben 3 horas gratis al registrarse\n• Sin presión de suscripción → Sin cuotas mensuales ni anuales; planes por horas, compra lo que necesites, los créditos nunca expiran"},"q4":{"q":"¿Por qué debería iniciar sesión?","a":"Iniciar sesión hace todo más conveniente:\n• Sincronización entre dispositivos → Accede a todas tus notas sin problemas en teléfono y tablet\n• Respaldo automático → Respalda tu trabajo de forma segura, sin preocupaciones al cambiar de teléfono"},"q5":{"q":"¿Qué idiomas soporta? ¿Traduce automáticamente?","a":"• Detección automática de idioma → No necesitas hacer nada, la app detecta múltiples idiomas automáticamente\n• Traducción automática de resúmenes → Los resúmenes se traducen automáticamente a tu idioma preferido, ¡entiende reuniones en otros idiomas al instante!"},"q6":{"q":"¿Hay límite de tiempo de grabación?","a":"¡Sin límite! Sin embargo, recomendamos dividir reuniones largas en segmentos para mejores resultados y una gestión más fácil."},"q7":{"q":"¿Puedo personalizar el formato del resumen?","a":"La IA selecciona automáticamente el mejor formato. También puedes elegir entre conciso, detallado, viñetas, elementos de acción o formatos personalizados."},"q8":{"q":"¿Cómo importo archivos de audio externos?","a":"Súper fácil, dos formas:\n• Comparte desde cualquier app → Toca \"Compartir\" en LINE, almacenamiento en la nube, etc.\n• Importa desde la app → Toca el botón \"+\" y selecciona archivos de tu teléfono (soporta mp3, m4a, wav y más)"},"q9":{"q":"¿Cómo exporto las notas de reunión?","a":"¡Comparte con un toque! Guarda como Word, PDF, TXT texto plano, o copia directamente el contenido para enviarlo a otros."},"q10":{"q":"¿En qué se diferencia Dopi Note de otras apps de grabación?","a":"Dopi Note se destaca por sus formatos de resumen flexibles, protección de privacidad en modo local y facturación flexible por horas — sin suscripción."},"q11":{"q":"¿Qué tan precisa es la transcripción?","a":"La precisión del reconocimiento AI depende de la calidad de grabación. En ambientes tranquilos con audio claro, la precisión es muy alta. Recomendamos mantener el teléfono cerca del hablante y evitar ruido de fondo excesivo para obtener los mejores resultados."},"q12":{"q":"¿Mis datos se usarán para entrenar IA?","a":"No. Sus grabaciones y notas son solo para su uso personal. No utilizamos ningún dato de usuario para el entrenamiento de modelos de IA. Su privacidad es nuestro principio más importante."}},"download":{"title":"Descarga Dopi Note - Tu Tiempo de Vuelta"},"contact":{"label":"Contáctanos:","email":"yijhen.yang@gmail.com"},"footer":{"copyright":"© 2025 Dopi Note. All rights reserved."}}
};

// 國際化 (i18n) 管理系統
class I18n {
  constructor() {
    this.currentLanguage = 'en'; // 預設英文
    this.translations = {};
    this.supportedLanguages = ['en', 'zh-TW', 'ja', 'es'];
    this.languageNames = {
      'en': 'English',
      'zh-TW': '繁體中文',
      'ja': '日本語',
      'es': 'Español'
    };
    this.documentClickBound = false; // 追蹤是否已綁定 document click

    this.init();
  }

  init() {
    // 偵測用戶語言偏好
    const detectedLang = this.detectLanguage();
    this.loadLanguage(detectedLang);
    this.updateContent();
    this.setupLanguageSwitcher();
  }

  detectLanguage() {
    // 1. 檢查 localStorage 中的偏好設定
    const storedLang = localStorage.getItem('preferred-language');
    if (storedLang && this.supportedLanguages.includes(storedLang)) {
      return storedLang;
    }

    // 2. 檢查瀏覽器語言設定
    const browserLang = navigator.language || navigator.languages?.[0];

    // 語言映射表
    const languageMapping = {
      'zh-TW': 'zh-TW',
      'zh-HK': 'zh-TW',
      'zh-CN': 'zh-TW', // 簡體也顯示繁體
      'zh': 'zh-TW',
      'ja': 'ja',
      'ja-JP': 'ja',
      'es': 'es',
      'es-ES': 'es',
      'es-MX': 'es',
      'es-AR': 'es',
      'en': 'en',
      'en-US': 'en',
      'en-GB': 'en'
    };

    // 檢查完整語言代碼
    if (languageMapping[browserLang]) {
      return languageMapping[browserLang];
    }

    // 檢查語言代碼的主要部分
    const mainLang = browserLang?.split('-')[0];
    if (languageMapping[mainLang]) {
      return languageMapping[mainLang];
    }

    // 預設返回英文
    return 'en';
  }

  loadLanguage(lang) {
    if (!this.supportedLanguages.includes(lang)) {
      lang = 'en'; // 回退到英文
    }

    try {
      // 從嵌入的語言資料讀取
      if (LANGUAGE_DATA[lang]) {
        this.translations = LANGUAGE_DATA[lang];
        this.currentLanguage = lang;

        // 儲存用戶偏好
        localStorage.setItem('preferred-language', lang);

        // 更新 HTML lang 屬性
        document.documentElement.lang = lang;
      } else {
        throw new Error(`Language data not found: ${lang}`);
      }
    } catch (error) {
      console.error('Error loading language:', error);

      // 如果不是英文且載入失敗，回退到英文
      if (lang !== 'en') {
        this.loadLanguage('en');
      }
    }
  }

  getText(key) {
    const keys = key.split('.');
    let value = this.translations;

    for (const k of keys) {
      // 處理陣列索引
      if (!isNaN(k) && Array.isArray(value)) {
        value = value[parseInt(k)];
      } else {
        value = value?.[k];
      }
      if (value === undefined) break;
    }

    return value || key; // 如果找不到翻譯，返回原 key
  }

  updateContent() {
    // 更新所有具有 data-i18n 屬性的元素
    const elements = document.querySelectorAll('[data-i18n]');

    elements.forEach(element => {
      const key = element.getAttribute('data-i18n');
      const text = this.getText(key);

      if (text && text !== key) {
        // 檢查是否是輸入框的 placeholder
        if (element.hasAttribute('placeholder')) {
          element.setAttribute('placeholder', text);
        } else {
          // 特殊處理：英日西語言在手機版的下載標題換行
          if (key === 'download.title' &&
              ['en', 'ja', 'es'].includes(this.currentLanguage) &&
              window.innerWidth <= 640) {
            element.innerHTML = text.replace(' - ', '<br>- ');
          } else {
            element.textContent = text;
          }
        }
      }
    });

    // 更新所有具有 data-i18n-alt 屬性的圖片 alt 文字
    const altElements = document.querySelectorAll('[data-i18n-alt]');
    altElements.forEach(element => {
      const key = element.getAttribute('data-i18n-alt');
      const text = this.getText(key);
      if (text && text !== key) {
        element.setAttribute('alt', text);
      }
    });

    // 更新 meta 標籤
    this.updateMetaTags();
  }

  updateMetaTags() {
    // 更新 title
    if (this.translations.meta?.title) {
      document.title = this.translations.meta.title;
    }

    // 更新 meta description
    const metaDesc = document.querySelector('meta[name="description"]');
    if (metaDesc && this.translations.meta?.description) {
      metaDesc.setAttribute('content', this.translations.meta.description);
    }

    // 更新 og:title
    const ogTitle = document.querySelector('meta[property="og:title"]');
    if (ogTitle && this.translations.og?.title) {
      ogTitle.setAttribute('content', this.translations.og.title);
    }

    // 更新 og:description
    const ogDesc = document.querySelector('meta[property="og:description"]');
    if (ogDesc && this.translations.og?.description) {
      ogDesc.setAttribute('content', this.translations.og.description);
    }
  }

  setupLanguageSwitcher() {
    // 建立語言切換器
    this.createLanguageSwitcher();
  }

  createLanguageSwitcher() {
    // 檢查是否已存在語言切換器
    if (document.querySelector('.language-switcher')) {
      return;
    }

    // 建立語言切換器容器
    const switcher = document.createElement('div');
    switcher.className = 'language-switcher';

    // 建立當前語言顯示按鈕
    const currentLangBtn = document.createElement('button');
    currentLangBtn.className = 'current-language';
    currentLangBtn.textContent = this.languageNames[this.currentLanguage];
    currentLangBtn.setAttribute('aria-label', 'Language selector');

    // 建立語言選項下拉選單
    const dropdown = document.createElement('div');
    dropdown.className = 'language-dropdown';

    this.supportedLanguages.forEach(lang => {
      if (lang !== this.currentLanguage) {
        const option = document.createElement('button');
        option.className = 'language-option';
        option.textContent = this.languageNames[lang];
        option.setAttribute('data-lang', lang);

        // 使用立即執行函數避免閉包問題
        ((selectedLang) => {
          option.addEventListener('click', (e) => {
            e.stopPropagation();
            this.switchLanguage(selectedLang);
          });
        })(lang);

        dropdown.appendChild(option);
      }
    });

    // 組裝語言切換器
    switcher.appendChild(currentLangBtn);
    switcher.appendChild(dropdown);

    // 加入到頁面底部的聯絡資訊區
    const contactInfo = document.querySelector('.contact-info');
    if (contactInfo) {
      contactInfo.appendChild(switcher);
    }

    // 點擊切換下拉選單顯示/隱藏
    currentLangBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.classList.toggle('show');
    });

    // 點擊其他地方關閉下拉選單（只綁定一次）
    if (!this.documentClickBound) {
      document.addEventListener('click', () => {
        const anyDropdown = document.querySelector('.language-dropdown.show');
        if (anyDropdown) {
          anyDropdown.classList.remove('show');
        }
      });
      this.documentClickBound = true;
    }
  }

  switchLanguage(lang) {
    if (lang === this.currentLanguage) return;

    this.loadLanguage(lang);
    this.updateContent();

    // 更新語言切換器
    const switcher = document.querySelector('.language-switcher');
    if (switcher) {
      switcher.remove();
      this.createLanguageSwitcher();
    }
  }
}

// 初始化國際化系統
document.addEventListener('DOMContentLoaded', () => {
  const i18n = new I18n();
  // 導出給其他腳本使用
  window.i18n = i18n;
});